# Airflow + Crypto Data Analytics

## Как запустить
```bash
docker compose up --build -d
```

## Как остановить
```bash
docker compose down --volumes
```

## Доступ
- http://localhost:8188
- логин: airflow
- пароль: airflow

## Как пользоваться
В списке будет два DAG:
1. Нужно запустить вручнную `init_crypto_database` - он создаст нужные для работы бд
2. Потом запустить `crypto_market_analytics` или подождать автоматического запуска (каждые 15 мин)

## Что делает
`crypto_market_analytics` собирает данные о топ 100 криптовалют из api.coinlore.net:
- цена
- изменение за 1 час и 24 часа
- капитализация
- объем торгов

Далее вычисляет метрики:
- среднее изменение цены за 24 часа по всем монетам
- общая капитализация топ 100
- процент доминирования btc (отношение капитализации BTC к общей капитализации рынка)

## Структура базы данных
Данные сохраняются в две таблицы:
- coins - информация о криптовалютах
- metrics - временные ряды с метриками

## Файлы проекта
- `dags/` - DAG файлы
  - `init_db.py` - инициализация бд
  - `crypto-getter.py` - сбор и вычисления данных
- `Dockerfile` - Airflow, копирование DAG-ов и установка библиотек
- `docker-compose.yml` - webserver, scheduler, init и две postgres бд (для airflow и для данных о криптовалютах)